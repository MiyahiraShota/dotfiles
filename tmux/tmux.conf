# =============================================
# TMUXの設定
# =============================================
#
# 基本設定
# ---------------------------------------------

# スクリーンモードの規定
set -g default-terminal "screen-256color"

#
# # Escapeのタイムラグj
set -s escape-time 0

# スクロールバッファ
set -g history-limit 10000

# ウィンドウとペインの番号を1から開始する（デフォルト0）
set-option -g base-index 1
set-window-option -g pane-base-index 1

# キーマップ
# ---------------------------------------------
#
# TMUX設定開発時に有効にするとよい
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
# bind-key r source-file ~/.tmux.conf \; display-message "config reloaded".
#
#
# プレフィックス
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

# キーバインドを解除
unbind C-b
# 新しいキーバインドを設定
set-option -g prefix C-a
# エスケープ処理
bind C-a send-prefix


# コピーペーストモード
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

# 選択中の移動をvi風のキーマップにする
setw -g mode-keys vi

# コピーは[ではなくyで開始
unbind [
bind y copy-mode

# ペーストは[ではなくpで実行
unbind p
bind p paste-buffer

# vで選択開始
bind-key -T copy-mode-vi 'v' send -X begin-selection

# yで選択領域をコピー
bind-key -T copy-mode-vi 'y' send -X copy-selection


bind-key "'" choose-session

# 同期
# ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
bind b set-window-option synchronize-panes on \; display-message 'Syncronize On'
bind B set-window-option synchronize-panes off \; display-message 'Syncronize Off'

# Prefix+- で横に、Prefix+| で縦に分割（ペイン）する
bind-key s split-window -h
bind-key v split-window -v

# Prefix + Ctrl-h/l でウィンドウ切り替え
# Prefix + Ctrl-h,h,h,h,...と連打できる
bind-key -r C-h select-window -t :-
bind-key -r C-l select-window -t :+

# Prefix+hjkl でペイン移動
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# ペインサイズを上下左右（Prefix+JKHL）に変更
# Prefix+J,J,J,J,...と連打してリサイズ可能
bind-key -r H resize-pane -L 5
bind-key -r J resize-pane -D 5
bind-key -r K resize-pane -U 5
bind-key -r L resize-pane -R 5

bind-key m set-option -g mouse \; display-message 'Mouse: On'
bind-key M set-option -g mouse \; display-message 'Mouse: Off'

# ショウくん
BIND -R F RESIZE-PANE -Z


# デザイン
# ---------------------------------------------
# MARK THIS TMUX AS INACTIVE (FOR CEDING CONTROL TO INNER TMUX WHEN NESTED)
BIND-KEY S-UP\
  SET-OPTION -G PREFIX C-B\;\
  SET-OPTION -G STATUS-STYLE "FG=COLOUR246,BG=COLOUR240,BOLD"\;\
  SET-OPTION -G MESSAGE-COMMAND-STYLE "FG=COLOUR246,BG=COLOUR240"\;\
  SET-OPTION -G MODE-STYLE "FG=COLOUR246,BG=COLOUR240"\;\
  SET-OPTION -G MESSAGE-STYLE "FG=COLOUR0,BG=COLOUR246"\;\
  SET-OPTION -G PANE-ACTIVE-BORDER-STYLE "FG=COLOUR240"\;\
  SEND-KEYS C-A M-F12

# RE-ACTIVATE THIS TMUX (FOR RETAKING CONTROL FROM INNER TMUX WHEN NESTED)
BIND-KEY S-DOWN\
  SET-OPTION -G PREFIX C-A\;\
  SET-OPTION -G STATUS-STYLE "FG=COLOUR45,BG=COLOUR24,BOLD"\;\
  SET-OPTION -G MESSAGE-COMMAND-STYLE "FG=COLOUR45,BG=COLOUR24"\;\
  SET-OPTION -G MODE-STYLE "FG=COLOUR45,BG=COLOUR24"\;\
  SET-OPTION -G MESSAGE-STYLE "FG=COLOUR0,BG=COLOUR45"\;\
  SET-OPTION -G PANE-ACTIVE-BORDER-STYLE "FG=COLOUR24"\;\
  SEND-KEYS C-A M-F11
 
# USED BY S-DOWN; DO NOT USE DIRECTLY.
BIND-KEY M-F11\
  SET-OPTION -G STATUS-STYLE "FG=COLOUR246,BG=COLOUR240,BOLD"\;\
  SET-OPTION -G MESSAGE-COMMAND-STYLE "FG=COLOUR246,BG=COLOUR240"\;\
  SET-OPTION -G MODE-STYLE "FG=COLOUR246,BG=COLOUR240"\;\
  SET-OPTION -G MESSAGE-STYLE "FG=COLOUR0,BG=COLOUR246"\;\
  SET-OPTION -G PANE-ACTIVE-BORDER-STYLE "FG=COLOUR240"

# USED BY S-UP; DO NOT USE DIRECTLY.
BIND-KEY M-F12\
  SET-OPTION -G STATUS-STYLE "FG=COLOUR45,BG=COLOUR24,BOLD"\;\
  SET-OPTION -G MESSAGE-COMMAND-STYLE "FG=COLOUR45,BG=COLOUR24"\;\
  SET-OPTION -G MODE-STYLE "FG=COLOUR45,BG=COLOUR24"\;\
  SET-OPTION -G MESSAGE-STYLE "FG=COLOUR0,BG=COLOUR45"\;\
  SET-OPTION -G PANE-ACTIVE-BORDER-STYLE "FG=COLOUR25"
# ステータスバーをトップに配置する
SET-OPTION -G STATUS-POSITION TOP

# 左右のステータスバーの長さを決定する
SET-OPTION -G STATUS-LEFT-LENGTH 90
SET-OPTION -G STATUS-RIGHT-LENGTH 90

# #H => マシン名
# #P => ペイン番号
# 最左に表示
SET-OPTION -G STATUS-LEFT '#H:[#P]'

# WI-FI、バッテリー残量、現在時刻
# 最右に表示
SET-OPTION -G STATUS-RIGHT '#[%Y-%M-%D(%A) %H:%M]'

# ステータスバーを UTF-8 に対応
#SET-OPTION -G STATUS-UTF8 ON

# ステータスバーを1秒毎に描画し直す
SET-OPTION -G STATUS-INTERVAL 1

# センタライズ（主にウィンドウ番号など）
SET-OPTION -G STATUS-JUSTIFY CENTRE

# 色設定
# ---------------------------------------------

# DEFAULT STATUSBAR COLORS
SET-OPTION -G STATUS-STYLE BG=YELLOW,FG=BLACK
SET-OPTION -G STATUS-STYLE DEFAULT

# DEFAULT WINDOW TITLE COLORS
SET-WINDOW-OPTION -G WINDOW-STATUS-STYLE FG=BRIGHTBLUE,BG=DEFAULT
#SET-WINDOW-OPTION -G WINDOW-STATUS-ATTR DIM

# ACTIVE WINDOW TITLE COLORS
SET-WINDOW-OPTION -G WINDOW-STATUS-CURRENT-STYLE FG=BRIGHTRED,BG=DEFAULT
#SET-WINDOW-OPTION -G WINDOW-STATUS-CURRENT-ATTR BRIGHT

# PANE BORDER
SET-OPTION -G PANE-BORDER-STYLE FG=BLACK
SET-OPTION -G PANE-ACTIVE-BORDER-STYLE FG=BRIGHTGREEN

# MESSAGE TEXT
SET-OPTION -G MESSAGE-STYLE BG=BLACK,FG=BRIGHTRED

# PANE NUMBER DISPLAY
SET-OPTION -G DISPLAY-PANES-ACTIVE-COLOUR BLUE #BLUE
SET-OPTION -G DISPLAY-PANES-COLOUR BRIGHTRED #ORANGE

# CLOCK
SET-WINDOW-OPTION -G CLOCK-MODE-COLOUR GREEN #GREEN

# BELL
SET-WINDOW-OPTION -G WINDOW-STATUS-BELL-STYLE FG=BLACK,BG=RED #BASE02, RED

# ステータスラインの設定
# ---------------------------------------------
SET -G STATUS-LEFT '#{?PANE_SYNCHRONIZED,#[BG=RED],}[#S]'

SET -G @TPM_PLUGINS '          \
TMUX-PLUGINS/TPM               \
TMUX-PLUGINS/TMUX-RESURRECT    \
TMUX-PLUGINS/TMUX-PAIN-CONTROL \
TMUX-PLUGINS/TMUX-CPU          \
TMUX-PLUGINS/TMUX-SENSIBLE     \
TMUX-PLUGINS/TMUX-BATTERY      \
TMUX-PLUGINS/TMUX-CONTINUUM    \
'
RUN-SHELL '~/.TMUX/PLUGINS/TPM/TPM'
SET -G STATUS-RIGHT '#{CPU_BG_COLOR} CPU: #{CPU_ICON} #{CPU_PERCENTAGE} | %A %H-%D %H:%M '
SET -G @CPU_LOW_ICON "ᚋ"
SET -G @CPU_MEDIUM_ICON "ᚌ"
SET -G @CPU_HIGH_ICON "ᚍ"

SET -G @CPU_LOW_FG_COLOR "#[FG=#00FF00]"
SET -G @CPU_MEDIUM_FG_COLOR "#[FG=#FFFF00]"
SET -G @CPU_HIGH_FG_COLOR "#[FG=#FF0000]"

SET -G @CPU_LOW_BG_COLOR "#[BG=#00FF00]"
SET -G @CPU_MEDIUM_BG_COLOR "#[BG=#FFFF00]"
SET -G @CPU_HIGH_BG_COLOR "#[BG=#FF0000]"

set-option -g status-style "fg=colour45,bg=colour24,bold"
set-option -g message-command-style "fg=colour45,bg=colour24"
set-option -g mode-style "fg=colour45,bg=colour24"
set-option -g message-style "fg=colour0,bg=colour45"
set-option -g pane-border-style "fg=colour240"
set-option -g pane-active-border-style "fg=colour24"

set-option -g status-left\
  "#{?client_prefix,C-a ,}#{?pane_in_mode,[tmux],#H:#S[#P]:#(cd #{pane_current_path} &&\
    if hg status 1>&2 2>/dev/null; then\
      echo \"($(hg book | grep \"^\\s\\*\" | cut -d' ' -f 3)) \";\
    elif git status 1>&2 2>/dev/null; then\
      echo \"($(git branch | grep \"^\\*\\s\" | cut -d' ' -f 2)) \";\
    fi;\
  )[#(echo #{pane_current_path} | sed \"\s?$HOME?~?1\")]}"
set-option -g status-left-length 60
set-option -g status-right-length 20
set-option -g status-right " %H:%M %d-%b-%y "
set-option -g status-justify right


## tmux-continuum
set -g @continuum-save-interval '60'
set -g @continuum-restore 'on'
